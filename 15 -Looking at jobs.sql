SELECT 
[sysjobs].[name] AS N'job_name',
[sysjobsteps].[step_name],
[sysjobsteps].[command] AS N'step_command',
[sysjobsteps].[database_name],
[sysjobsteps].[last_run_date],
[sysjobsteps].[last_run_time]
FROM [msdb].[dbo].[sysjobsteps]
INNER JOIN [msdb].[dbo].[sysjobs]
ON [msdb].[dbo].[sysjobsteps].[job_id] = [msdb].[dbo].[sysjobs].[job_id]
where [sysjobsteps].[command] like 'rpt_project_analysis%'

/*  DECLARE @date AS DATETIME  SET @date = dateadd(day,datediff(day,'19000101',getdate()),'19000101');    declare @date2 datetime  set @date2 = DATEADD(dd,1,@date)    delete from mi.dbo.v63_hrly_rates WHERE dateadd(day,datediff(day,'19000101',start_time),'19000101')   = @date  insert into   mi.dbo.v63_hrly_rates  select *,RANK()OVER (partition by site order by site,rate_hr desc) as ranked,RANK()OVER (partition by site order by site,activity desc) as ranked_vol  --into mi.dbo.v63_hrly_rates  from (   select employee_no,     first_name,     last_name ,     team_leader,     site,      mi.dbo.DeductBreakTime(employee_no,start_time,end_time) as break_time,     DATEDIFF(MINUTE,start_time,end_time) as tot_time,     DATEDIFF(MINUTE,start_time,end_time)-mi.dbo.DeductBreakTime(employee_no,start_time,end_time) as net_time,     start_time,     end_time,     activity,     case when convert(float,(DATEDIFF(MINUTE,start_time,end_time)-mi.dbo.DeductBreakTime(employee_no,start_time,end_time)))=0     then 0 else (activity/convert(float,(DATEDIFF(MINUTE,start_time,end_time)-mi.dbo.DeductBreakTime(employee_no,start_time,end_time))))*60 end as rate_hr         from (     SELECT  count(*) as activity,min(datetime)start_time,MAX(datetime) as end_time,first_name ,last_name,employee_no,team_leader,sm.site     FROM    mi.dbo.DLA_AA_FINAL_OUTPUT_Do_Not_Drop_Log l WITH(nolock)       left outer join mops.dbo.secure s with (nolock)        on l.USERID = s.userid       LEFT JOIN mibi_staffing_matrix sm WITH(nolock)        on s.designation = employee_no                         WHERE DATETIME>=@date     and DATETIME<=@date2     --and employee_no = @emp     group by employee_no,first_name ,last_name,team_leader,sm.site     )sub1        )sub2    */  DECLARE @date AS DATETIME  SET @date = dateadd(day,datediff(day,'19000101',getdate()),'19000101');    declare @date2 datetime  set @date2 = DATEADD(dd,1,@date)    delete from mi.dbo.v63_hrly_rates WHERE dateadd(day,datediff(day,'19000101',start_time),'19000101')   = @date  insert into   mi.dbo.v63_hrly_rates  select employee_no,     first_name,     last_name ,     team_leader,     site,     break_time,     tot_time,     net_time,     start_time,     end_time,     activity,     rate_hr,     RANK()OVER (partition by site order by site,rate_hr desc) as ranked,RANK()OVER (partition by site order by site,activity desc) as ranked_vol,     processingwh  --into mi.dbo.v63_hrly_rates  from (   select employee_no,     first_name,     last_name ,     team_leader,     site,      mi.dbo.DeductBreakTime(employee_no,start_time,end_time) as break_time,     DATEDIFF(MINUTE,start_time,end_time) as tot_time,     DATEDIFF(MINUTE,start_time,end_time)-mi.dbo.DeductBreakTime(employee_no,start_time,end_time) as net_time,     start_time,     end_time,     activity,     case when convert(float,(DATEDIFF(MINUTE,start_time,end_time)-mi.dbo.DeductBreakTime(employee_no,start_time,end_time)))=0     then 0 else (activity/convert(float,(DATEDIFF(MINUTE,start_time,end_time)-mi.dbo.DeductBreakTime(employee_no,start_time,end_time))))*60 end as rate_hr     ,processingwh    from (     SELECT  count(*) as activity,min(datetime)start_time,MAX(datetime) as end_time,first_name ,last_name,employee_no,team_leader,sm.site,l.processingwh     FROM    mi.dbo.DLA_AA_FINAL_OUTPUT_Do_Not_Drop_Log l WITH(nolock)       left outer join mops.dbo.secure s with (nolock)        on l.USERID = s.userid       LEFT JOIN mi.dbo.mibi_staffing_matrix sm WITH(nolock)        on s.designation = employee_no                         WHERE DATETIME>=@date     and DATETIME<=@date2     --and employee_no = @emp     group by employee_no,first_name ,last_name,team_leader,sm.site,PROCESSINGWH     )sub1        )sub2  